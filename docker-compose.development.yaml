version: "3"

services:
  nginx:
    build:
      context: .
      dockerfile: Dockerfile 
    ports:
      - "80:80"

  delivery:
    build: 
      context: ./delivery
      target: development
    volumes:
      - ./delivery:/app
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/delivery/ping"]
      interval: 30s
      timeout: 10s
      retries: 5

  order:
    build: 
      context: ./order
      target: development
    volumes:
      - ./order:/app
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/order/ping"]
      interval: 30s
      timeout: 10s
      retries: 5

  restaurant:
    build: 
      context: ./restaurant
      target: development
    volumes:
      - ./restaurant:/app
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/restaurant/ping"]
      interval: 30s
      timeout: 10s
      retries: 5

  user:
    build: 
      context: ./user
      target: development
    volumes:
      - ./user:/app
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/user/ping"]
      interval: 30s
      timeout: 10s
      retries: 5

  simulator:
    build: 
      context: ./simulator
      target: development
    volumes:
      - ./simulator:/app
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/simulator/ping"]
      interval: 30s
      timeout: 10s
      retries: 5
